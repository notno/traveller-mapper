<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Density Heat Map Generator</title>
    <!-- Remove nonexistent styles file; optionally you can add your own CSS file -->
    <!-- <link rel="stylesheet" href="style.css"> -->
    <!-- Load world generation logic before the main script -->
    <script defer src="worldgen.js"></script>
    <script defer src="script.js"></script>
</head>
<body>
    <header>
        <h1>Star Density Heat Map Generator</h1>
        <p>
            This tool now generates a star‑density heat map for an entire sector
            of Traveller space. A sector is composed of 4 × 4 subsectors; each
            subsector contains an 8 × 10 hex grid. Within each subsector the
            densities are created using a simplified slime‑mold algorithm:
            agents sense the pheromone field ahead, slightly to the left and
            right, turn towards the strongest stimulus, move forward, deposit
            trail, and the trail diffuses and decays.
            The aggregated field is quantized into discrete colour levels, from
            black to white. Use the controls below to adjust the number of
            levels, regenerate the pattern and download it as a PNG. PNG
            format preserves transparency in the areas outside the hex tiles,
            making it suitable for overlaying or further compositing.
        </p>
    </header>
    <!-- Single World Generator section -->
    <section id="worldGenSection">
        <h2>Single World Generator</h2>
        <button id="generateWorldBtn">Generate World</button>
        <!-- Output area for single world details.  Use pre-wrap so line breaks are preserved and give it a border for readability -->
        <pre id="worldOutput" style="white-space: pre-wrap; border: 1px solid #ccc; padding: 4px; margin-top: 4px; background: #f7f7f7;"></pre>
    </section>
    <section id="controls">
        <label for="bitDepth">Levels
            <!-- Allow up to 16 discrete levels. 2 = black/white; 16 = 16 greys. -->
            <input type="range" id="bitDepth" min="2" max="16" value="16">
        </label>
        <span id="bitDepthValue">16</span>
        <!-- Zoom control: allow users to scale the canvas for readability -->
        <label for="zoom">Zoom
            <input type="range" id="zoom" min="0.5" max="4" step="0.1" value="1">
        </label>
        <span id="zoomValue">1.0×</span>
        <!-- Simulation scale: adjust agent sensor distance and speed to affect pattern scale -->
        <label for="simScale">Simulation scale
            <!-- Cap the simulation scale slider at 1.0.  Values above 1 produce
                 patterns that are too sparse, so we limit the maximum to 1.0. -->
            <input type="range" id="simScale" min="0.5" max="1" step="0.1" value="1">
        </label>
        <span id="simScaleValue">1.0</span>
        <!-- Saturate slider: biases the distribution of density values.
             Values above 1 lighten the map (increase the likelihood of brighter values);
             values below 1 darken it. -->
        <label for="saturate">Saturate
            <!-- Increase the maximum saturate value to 5 to allow brighter maps and more +1s -->
            <input type="range" id="saturate" min="0.5" max="5" step="0.1" value="1">
        </label>
        <span id="saturateValue">1.0</span>
        <!-- Display mode toggle: choose between raw density levels and world occurrence DM -->
        <span id="displayModeLabel">Display</span>
        <label>
            <input type="radio" name="displayMode" value="density"> Density
        </label>
        <label>
            <input type="radio" name="displayMode" value="dm" checked> World DM
        </label>

        <!-- Presence threshold: when display mode is Density, this slider determines
             whether a world is considered present in a hex.  A lower threshold
             means even dim areas count as worlds; a higher threshold restricts
             worlds to the brightest regions.  Threshold values range from 1 to
             the current number of quantisation levels. -->
        <label for="presenceThreshold">World&nbsp;presence
            <input type="range" id="presenceThreshold" min="1" max="16" value="8">
        </label>
        <span id="presenceThresholdValue">8</span>

        <!-- Toggle subsector boundary visibility -->
        <label>
            <input type="checkbox" id="showBoundaries" checked> Boundaries
        </label>

        <!-- Whole world generation: when checked, generates a Traveller-style world
             for every hex that meets the presence threshold and displays its
             UWP code on the map. -->
        <label>
            <input type="checkbox" id="wholeWorlds"> Whole world generation
        </label>

        <!-- Map mode toggle: choose between a single 4×4 subsector sector (default)
             and a larger multi-sector view.  In vastness mode the generator
             displays an expanded grid of subsectors to simulate contiguous
             sectors. -->
        <span id="mapModeLabel">Map mode</span>
        <label>
            <input type="radio" name="mapMode" value="single" checked> Single
        </label>
        <label>
            <input type="radio" name="mapMode" value="vastness"> Vastness
        </label>

        <!-- Printable mode: when checked, cells are rendered with dot patterns instead of solid greys. -->
        <label for="printable">Printable
            <input type="checkbox" id="printable">
        </label>

        <!-- Seed input and display: shows the current random seed and allows
             the user to enter a seed to regenerate a previous map.  If the
             input is left blank when generating a new map, a new random
             seed will be chosen automatically.  The current seed is
             displayed in this box after generation. -->
        <label for="seedInput">Seed
            <input type="text" id="seedInput" size="10" placeholder="(auto)">
        </label>
        <span id="seedDisplay"></span>
        <button id="randomizeSeed">Randomize seed</button>
        <button id="generate">Generate from seed</button>
        <!-- Download the entire sector at high resolution -->
        <button id="download">Download sector PNG</button>
        <!-- Button to download a selected subsector; hidden until a subsector is clicked -->
        <button id="downloadSubsector" style="display:none;">Download subsector PNG</button>
    </section>
    <div id="canvasWrapper">
        <canvas id="heatmapCanvas" width="800" height="800">
            Your browser does not support the HTML5 canvas element.
        </canvas>
        <!-- Tooltip for world details; positioned absolutely and hidden by default -->
        <div id="tooltip" style="position:absolute; display:none; pointer-events:none; background-color:rgba(255,255,255,0.95); border:1px solid #333; border-radius:4px; padding:4px; font-size:12px; z-index:10;"></div>
    </div>
    <footer>
        <p>
            The underlying algorithm is inspired by Jeff Jones’ Physarum model
            in which a swarm of agents senses the pheromone field ahead and
            slightly to either side, turns toward the strongest signal, moves
            forward, deposits pheromone, and the field diffuses and decays.
            Adjusting the sensor angle, rotation angle and other parameters
            produces a variety of organic‑looking patterns.
        </p>
    </footer>
</body>
</html>