<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Density Heat Map Generator</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Load world generation logic before the main script -->
    <script defer src="worldgen.js"></script>
    <script defer src="script.js"></script>
</head>
<body>
    <header>
        <h1>Strands and Clusters</h1>
        <h2>A tool for generating organic-looking star maps for 2d6 sci-fi games, v0.0.2</h2>
        <ul>
        <li>Generate a single UWP (<a href="https://www.orffenspace.com/cepheus-srd/book3/worlds.html">Universal World Profile</a>)</li>
        <li>Generate a map of UWPs</li>
        </ul>
        <p>Currently based on rules from <a href="https://www.drivethrurpg.com/en/product/415159/cepheus-deluxe-enhanced-edition">Cepheus Deluxe.</a></p>
    </header>
    <!-- Single World Generator section -->
    <section id="worldGenSection" class="panel">
        <h2>Single World Generator</h2>
        <p>Generates an 8-digit code (UWP) detail:</p>
        <ol>
            <li>Starport</li>
            <li>Size</li>
            <li>Atmosphere</li>
            <li>Hydrology</li>
            <li>Population</li>
            <li>Governement</li>
            <li>Law</li>
            <li>TechLevel</li>
        </ol>
        <p>An asterisk* indicates the presence of a gas giant in the system.</p>
        <p>Trade codes:</p>
        <ul>
            <li>Agricultural: <b>Ag</b></li>
            <li>Asteroid: <b>As</b></li>
            <li>Barren: <b>Ba</b></li>
            <li>Non-water fluid oceans: <b>Fl</b></li>
            <li>Garden: <b>Ga</b></li>
            <li>High population: <b>Hi</b></li>
            <li>High technology: <b>Ht</b></li>
            <li>Ice-capped: <b>Ic</b> </li>
            <li>Industrial: <b>In</b></li>
            <li>Low population: <b>Lo</b></li>
            <li>Low technology: <b>Lt</b></li>
            <li>Non-agricultural: <b>Na</b></li>
            <li>Poor: <b>Po</b></li>
            <li>Rich: <b>Ri</b></li>
            <li>Water world: <b>Wa</b></li>
            <li>Vacuum: <b>Va</b></li>
        </ul>
        <p>Base codes:</p>
        <ul>
           <li>Naval: N</li>
           <li>Pirate: P</li>
            <li>Research: R</li>
            <li>Scout: S</li>
        </ul>
        <button id="generateWorldBtn">Generate World</button>
        <!-- Output area for single world details.  Use pre-wrap so line breaks are preserved and give it a border for readability -->
        <pre id="worldOutput" class="panel-output"></pre>
    </section>
    <header>
        <p>
            This tool generates a star‑density heat map for one to four sectors
            of Traveller space. A sector is composed of 4 × 4 subsectors; each
            subsector contains an 8 × 10 hex grid.
        </p>
        <p>Within each subsector the densities are created using a simplified slime‑mold algorithm:
            agents sense the pheromone field ahead, slightly to the left and
            right, turn towards the strongest stimulus, move forward, deposit
            trail, and the trail diffuses and decays.
        </p>
        <p>
            The aggregated field is quantized into discrete color levels, from
            black to white. Use the controls below to adjust the number of
            levels, regenerate the pattern and download it as a PNG.
        </p>
    </header>
    <section id="controls" class="panel">
        <h2>Sector Generator</h2>
        <div class="controls-grid">
            <div class="control-panel">
                <h3>Content</h3>
                <div class="control-group">
                    <div class="control-row">
                        <!-- Density slider: biases the distribution of density values.
                             Values above 1 lighten the map (increase the likelihood of brighter values);
                             values below 1 darken it. -->
                        <label for="saturate">Density
                            <!-- Increase the maximum density value to 5 to allow brighter maps and more +1s -->
                            <input type="range" id="saturate" min="0.1" max="5" step="0.1" value="1">
                        </label>
                        <span id="saturateValue">1.0</span>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <!-- Presence threshold: when display mode is World generation, this slider determines
                             whether a world is considered present in a hex.  A lower threshold
                             means even dim areas count as worlds; a higher threshold restricts
                             worlds to the brightest regions.  Threshold values range from 1 to
                             the current number of quantisation levels. -->
                        <label for="presenceThreshold">Density threshold (a high-pass filter)
                            <input type="range" id="presenceThreshold" min="1" max="16" value="4">
                        </label>
                        <span id="presenceThresholdValue">4</span>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <label for="bitDepth">Levels of density
                            <!-- Allow up to 32 discrete levels. 2 = black/white; 32 = 32 greys. -->
                            <input type="range" id="bitDepth" min="2" max="32" value="16">
                        </label>
                        <span id="bitDepthValue">16</span>
                    </div>
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <!-- Simulation scale: adjust agent sensor distance and speed to affect pattern scale -->
                        <label for="simScale">Simulation zoom
                            <!-- Cap the simulation zoom slider at 1.5.  Values above 1 produce
                                 patterns that are too sparse, so we limit the maximum to 1.0. -->
                            <input type="range" id="simScale" min="0.3" max="1.5" step="0.1" value="1">
                        </label>
                        <span id="simScaleValue">1.0</span>
                    </div>
                </div>
                <div class="control-group">
                    <!-- Generation mode toggle: choose between world generation and occurrence DM -->
                    <span id="displayModeLabel" class="control-group__label">Generation mode</span>
                    <label class="control-option">
                        <input type="radio" name="displayMode" value="density" checked> World generation
                    </label>
                    <label class="control-option">
                        <input type="radio" name="displayMode" value="dm"> World occurrence DM (dice modifier)
                    </label>
                </div>
            </div>
            <div class="control-panel">
                <h3>Display</h3>
                <div class="control-group">
                    <!-- Map mode toggle: choose between a single 4×4 subsector sector (default)
                         and a larger multi-sector view.  In vastness mode the generator
                         displays an expanded grid of subsectors to simulate contiguous
                         sectors. -->
                    <span id="mapModeLabel" class="control-group__label">Map mode</span>
                    <label class="control-option">
                        <input type="radio" name="mapMode" value="single" checked> Single Sector
                    </label>
                    <label class="control-option">
                        <input type="radio" name="mapMode" value="vastness"> 2x2 Sectors
                    </label>
                </div>
                <div class="control-group">
                    <div class="control-row">
                        <!-- Zoom control: allow users to scale the canvas for readability -->
                        <label for="zoom">Map zoom
                            <input type="range" id="zoom" min="0.5" max="4" step="0.1" value="1.3">
                        </label>
                        <span id="zoomValue">1.3×</span>
                    </div>
                </div>
                <div class="control-group">
                    <span class="control-group__label">Overlays</span>
                    <!-- Toggle subsector boundary visibility -->
                    <label class="control-option">
                        <input type="checkbox" id="showBoundaries" checked> Boundaries
                    </label>
                    <!-- Printable mode: when checked, cells are rendered with dot patterns instead of solid greys. -->
                    <label class="control-option" for="printable">
                        <input type="checkbox" id="printable"> Printable
                    </label>
                </div>
            </div>
            <div class="control-panel control-panel--wide">
                <h3>Seed</h3>
                <div class="control-group">
                    <!-- Seed input and display: shows the current random seed and allows
                         the user to enter a seed to regenerate a previous map.  If the
                         input is left blank when generating a new map, a new random
                         seed will be chosen automatically.  The current seed is
                         displayed in this box after generation. -->
                    <div class="control-row">
                        <label for="seedInput">Seed
                            <input type="text" id="seedInput" size="10" placeholder="(auto)">
                        </label>
                        <span id="seedDisplay"></span>
                    </div>
                </div>
            </div>
            <div class="button-row">
                <button id="randomizeSeed">Randomize seed</button>
                <button id="generate">Generate from seed</button>
                <!-- Download the entire sector at high resolution -->
                <button id="download">Download sector PNG</button>
                <!-- Button to download a selected subsector; hidden until a subsector is clicked -->
                <button id="downloadSubsector" class="is-hidden">Download subsector PNG</button>
            </div>
        </div>
    </section>
    <div id="canvasWrapper">
        <canvas id="heatmapCanvas" width="800" height="800">
            Your browser does not support the HTML5 canvas element.
        </canvas>
        <!-- Tooltip for world details; positioned absolutely and hidden by default -->
        <div id="tooltip" class="tooltip"></div>
    </div>
    <footer>
        <p>
            The underlying algorithm is inspired by Jeff Jones’ Physarum model
            in which a swarm of agents senses the pheromone field ahead and
            slightly to either side, turns toward the strongest signal, moves
            forward, deposits pheromone, and the field diffuses and decays.
            Adjusting the sensor angle, rotation angle and other parameters
            produces a variety of organic‑looking patterns.
        </p>
    </footer>
</body>
</html>
